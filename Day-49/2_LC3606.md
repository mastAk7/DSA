```cpp
class Solution {
public:
    bool check(string &code, string &bline){
        if(code=="") return false;
        for(auto x:code) if(!((x>='a' && x<='z') || (x>='A' && x<='Z') || (x>='0' && x<='9') || x=='_')) return false;
        if(bline!="electronics" && bline!="grocery" && bline!="pharmacy" && bline!="restaurant") return false;
        return true;
    }
    vector<string> validateCoupons(vector<string>& code, vector<string>& businessLine, vector<bool>& isActive) {
        vector<string> ans;
        vector<vector<string>> temp;
        for(int i=0; i<code.size(); i++) if(isActive[i] && check(code[i],businessLine[i])){
            temp.push_back({code[i],businessLine[i]});
        }
        sort(temp.begin(),temp.end(),
        [](vector<string> &x, vector<string> &y){
            if(x[1]==y[1]) return x[0]<y[0];
            return x[1]<y[1];
        });
        for(auto &x:temp) ans.push_back(x[0]);
        return ans;
    }
};
```